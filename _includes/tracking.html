<div class="modal">
    <div class="modal-content">
        <h4>Tracking</h4>
        <p>This site uses cookies to track your activities.</p>
        <button class="material flat initial" id="enableTracking">OK</button>
        <button class="material flat" id="disableTracking">I don't like that</button>
    </div>
</div>
<script>
    (function () {
        var a = false;
        const trackingCookie = getTrackingCookie();
        if (trackingCookie === undefined) {
            let modal = document.querySelector(".modal");
            modal.style.display = "block";

            let enableTrackingBtn = document.getElementById("enableTracking");
            let disableTrackingBtn = document.getElementById("disableTracking");

            enableTrackingBtn.onclick = function () { enableAnalytics(); };
            disableTrackingBtn.onclick = function () { window.location = "https://google.com/"; };

        } else if (trackingCookie === "true") {
            enableAnalytics();
        }
        setTimeout(() => {
            if (trackingCookie === undefined) {
                enableAnalytics();
            }
        }, 7000);
    })();

    function getTrackingCookie() {
        let cookieArray = document.cookie.split(";");
        const trackingCookie = cookieArray.find(c => c.trim().startsWith("tracking="));
        if (trackingCookie === undefined) {
            return undefined;
        }
        return trackingCookie.split("=")[1];
    }
    function enableAnalytics() {
        let modal = document.querySelector(".modal");
        modal.style.display = "none";
        document.cookie = "tracking=true; max-age=378432000; path=/";

        fetch('https://pi.licua.de/page-impression', {
            method: 'POST'
        }).then(res => { }).catch(error => { });

        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date(); a = s.createElement(o),
                m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
        })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

        ga('create', '{{ site.google_analytics }}', 'auto');
        ga('send', 'pageview');
    }
</script>