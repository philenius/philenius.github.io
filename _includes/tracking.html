<div class="modal">
    <div class="modal-content">
        <h1>Tracking</h1>
        <p>I'd like to know whether there's someone reading the non-sense on my blog.<br>
            So, may I ask you for your consent to track your activities using cookies?</p>
        <button class="material flat initial" id="enableTracking">OK</button>
        <button class="material flat" id="disableTracking">No tracking please</button>
    </div>
</div>
<script>
    (function () {
        const trackingCookie = getTrackingCookie();
        if (trackingCookie === undefined) {
            let modal = document.querySelector(".modal");
            modal.style.display = "block";

            let enableTrackingBtn = document.getElementById("enableTracking");
            let disableTrackingBtn = document.getElementById("disableTracking");

            enableTrackingBtn.onclick = function () {
                modal.style.display = "none";
                document.cookie = "tracking=true; max-age=378432000; path=/";
                enableAnalytics();
            };

            disableTrackingBtn.onclick = function () {
                modal.style.display = "none";
                document.cookie = "tracking=false; max-age=378432000; path=/";
            };

        } else if (trackingCookie === "true") {
            enableAnalytics();
        }
    })();

    function getTrackingCookie() {
        let cookieArray = document.cookie.split(";");
        const trackingCookie = cookieArray.find(c => c.trim().startsWith("tracking="));
        if (trackingCookie === undefined) {
            return undefined;
        }
        return trackingCookie.split("=")[1];
    }

    function enableAnalytics() {
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date(); a = s.createElement(o),
                m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
        })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

        ga('create', '{{ site.google_analytics }}', 'auto');
        ga('send', 'pageview');
    }
</script>